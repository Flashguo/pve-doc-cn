# 11.8 备份和恢复

## 11.8.1容器备份

可以使用vzdump命令备份容器。详细信息请参考vzdump的man手册。

## 11.7.2容器备份恢复

可以用pct restore命令将vzdump生成的容器备份恢复出来。默认情况下，pct restore将尝试尽可能按照备份文件中的配置信息恢复容器。但也可以在恢复命令中手工指定容器配置参数，以覆盖备份文件中的配置备份（详情可查看pct命令的man手册）。

- 注意
  
  可运行命令pvesm extractconfig查看vzdump备份文件中的配置备份信息。

根据对挂载点处理方式的不同，一共有两种恢复模式：

### “简单”恢复模式

如果在恢复命令中既没有指定rootfs参数也没有指定任何mpX参数，则按以下步骤从备份配置文件恢复挂载点配置信息：

 - 1.从备份文件提取挂载点及相关配置项。
 
 - 2.对于基于存储服务的挂载点，创建相应存储卷（在storage参数指定的存储服务上创建，如未设置则默认在local存储服务上创建）。
  
 - 3.从备份文件中提取备份数据。

 - 4.增加绑定挂载点和设备挂载点，并进一步恢复配置（仅限于root用户）。
基于Web界面的恢复操作采用的就是简单模式。

- 注意
  鉴于绑定挂载点和设备挂载点中的数据永远不会被备份，因此最后一步中不会有任何实际数据被恢复，而仅仅是恢复挂载点配置信息。这种处理方法基于一个前提假设，即这两类挂载点中的数据已被其他机制备份（例如，同时绑定挂载到多个容器的NFS存储空间），或根本不需要备份。

### “高级”恢复模式

如果指定rootfs参数（或者，指定任意mpX参数组合），恢复命令pct restore将自动进入高级恢复模式。高级恢复模式将完全忽略备份文件中保存的rootfs和mpX配置信息，转而采用命令行中指定的配置信息。

高级模式允许在恢复操作时灵活配置挂载点信息，例如：

- 为每个挂载点分别设置目标存储，存储卷容量及其他配置参数。

- 按照新指定的挂载点调整备份文件数据存储分布情况。

- 恢复到设备挂载点和（或）绑定挂载点（仅限于root用户）。
