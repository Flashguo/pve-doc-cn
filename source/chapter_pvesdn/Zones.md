# 12.3 区域

区域将定义虚拟分离的网络。

它可以使用不同的技术进行分离：

- VLAN：虚拟LAN是细分LAN的经典方法

- QinQ：堆叠VLAN(正式名称为IEEE 802.1ad)

- VXLAN：(第2层VXLAN)

- Simple: 隔离网桥，简单的3层路由网桥(NAT)

- bgp-evpn：使用第3层边界网关协议路由的VXLAN


您可以将区域限制为特定节点。
还可以在区域上添加权限，以限制用户仅使用特定区域且仅使用该区域中的VNET。

## 12.3.1. 通用选项

- 节点

  仅在这些节点上部署并允许使用为此区域配置的VNet。

- ipam

  可选配置，配置在此区域使用的ip管理工具

- dns服务器
  
  可选配置，选择DNS服务器

- 反向Dns服务器

  可选配置，选择反向DNS服务器

- DNS域

  可选配置。设置DNS域名。这样主机名就会是`<hostname>.<domain>`格式。DNS域需要提前在DNS服务上配置。

## 12.3.2. Simple 区域

这是最简单的插件，它将创建一个隔离的vnet桥接器。此网桥不链接到物理接口，VM 流量仅是节点的本地流量。它还可用于 NAT 或路由设置。

## 12.3.3 VLAN 区域

这是最简单的插件，它将使用现有的本地Linux或OVS网桥，并在其上管理VLAN。使用SDN模块的好处是，您可以使用特定的VNet VLAN标签创建不同的区域，并将虚拟机限制在不同的区域。

指定VLAN配置选项：

bridge
  
  使用已在每个本地节点上配置的此本地网桥或OVS交换机。

## 12.3.4. QinQ 区域

QinQ是堆叠VLAN。为分区定义的第一个VLAN标记(所谓的service-VLAN)，以及为vnet定义的第二个VLAN标记

- 注意

  您的物理网络交换机必须支持堆叠VLAN！

指定QinQ配置选项：

- bridge

  已在每个本地节点上配置的本地VLAN-aware网桥

- VLAN服务

  该zone的主VLAN标签

- VLAN服务协议

  允许指定 802.1q（默认）或 802.1ad 作为vlan 类型。

-  mtu
  
   由于标签的双层堆叠，QinQ VLAN需要多4个字节。例如，如果物理接口MTU为1500，则将MTU减少到1496。

## 12.3.5. VXLAN 区域


VXLAN插件将在现有网络(名为Underlay)之上建立隧道(名为Overlay)，将第2层以太网帧封装在第4层UDP数据报中，使用4789作为默认目的端口。例如，您可以在公共Internet网络节点之上创建专用IPv4 VXLAN网络。

这只是第2层隧道，不可能在不同的VNET之间进行路由。

每个VPN将使用范围(1-16777215)中的特定VxLAN ID。

指定EVPN配置选项：

- 对端地址列表

  要通过其进行通信的所有节点的IP列表。也可以是外部节点。

- mtu

  由于VXLAN封装使用50字节，因此MTU需要比传出物理接口低50字节。

## 12.3.6. EVPN 区域

这是所有支持的插件中最复杂的。

BGP-EVPN允许创建路由的第3层网络。EVPN的VPN可以具有任播IP地址和MAC地址。每个节点上的网桥IP都是相同的，因此虚拟访客可以将该地址用作网关。

路由可以通过VRF(虚拟路由和转发)接口跨来自不同区域的VNet工作。

指定EVPN配置选项：

- VRF VXLAN Tag 
  
  这是用于在vnet之间路由互连的vxlan-id，它必须不同于vnet的vxlan-id

- controller

  首先需要定义EVPN控制器(参见控制器插件部分)

- VNet MAC 地址

  此区域中所有 VNet 的唯一任播 MAC 地址。如果未定义，将自动生成。

- 退出节点

  如果要定义一些 proxmox 节点，作为从 evpn 网络到真实网络的出口网关，则使用此选项。配置的节点将在 EVPN 网络中宣布默认路由

- Advertise Subnets（发布子网）
 
  可选配置。如果存在一些消极VM/CT（例如，接口上存在多个ip地址，并且任播网关看不到来自这些 ip 的流量，则无法在 evpn 网络内访这些ip地址）。在这种情况下，此选项将宣布 evpn 网络中的完整子网.
  
- Exit Nodes local routing（出口节点本地路由）

  可选配置。 如果需要从出口节点访问 vm/ct 服务，这是一个特殊选项。（默认情况下，出口节点仅允许在真实网络和 evpn 网络之间转发流量）。

- MTU

  由于 VXLAN 封装使用 50 个字节，因此 MTU 需要比传出物理接口的最大 MTU 低 50 个字节。

