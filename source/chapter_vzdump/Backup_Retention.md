# 16.5. 备份保留
使用备份保留选项，可以灵活的指定要保留的备份。

备份保留有以下可用选项：

- 保留所有备份 <boolean>
  
  勾选即保留所有的历史备份，且其他选项将不可选。

- 保留上次 <N>
  
  保留最近N次备份。

- 保留每小时 <N>

  以小时为计算度量，保留最近4次的小时备份。
  
  若计划，1：00，2：00，12：00备份，小时设置为4，则保留当天，12：00，2：00，1：00。

- 保留每天 <N>

  以天为计算度量，保留最近N天的备份。一天若有多个备份，保留最新备份。
  
  在上面的基础上，若天设置为3，则会保留，昨天12：00，前天12：00，大前天12:00数据

- 保留每周 <N>

  以周为计算度量，保留最近N周的备份。如果一周内有多个备份，则仅保留最新的备份

  在上面的基础上，若周设置为3，则会保存，之前三周，每周日12：00的备份

- 保留每月 <N>

  以月为计算度量，保留最近N月的备份
  
  在上面的基础上，若月设置为3，则会保留最近3个月30或31日的12：00的备份。

- 保留每年 <N>

  保留过去几年的备份，如果一年有多个备份，则会保留最新的备份。

备份保留功能会按照上面的顺序执行。每个选项只在其时间段涵盖备份，下一个选项不处理已覆盖的备份。它只会处理比较旧的备份。意味着，如果周和天，有重复的备份，那么周备份不会去处理天的备份，而是会处理下一份旧备份。

`此功能，建议直接使用PBS的调度模拟器查看备份计划！`


可以使用逗号作为分隔符，指定需要的保留选项，如：


```
# vzdump 777 --prune-backups keep-last=3,keep-daily=13,keep-yearly=9
```

这样可以直接将备份保留选项传递给vzdump，但在web面板上配置基于存储的备份计划更为明智。

提示：

旧的 maxfiles 选项已弃用，应替换为keep-last，或者如果maxfiles为0 ，则表示无限保留，则应替换为keep-all。


## 16.5.1. 调度模拟器

您可以使用 [Proxmox 备份服务器文档的调度模拟器](https://pbs.proxmox.com/docs/prune-simulator)来查看具有不同备份时间表的不同保留选项的效果。

## 16.5.2. 保留设置示例

备份频率和旧备份保留应该根据数据更改频率，以及在特定工作负载下，旧备份的重要性来进行设置。当备份作为公司文档时，可能法律还会要求存档应保留多久。

例如，正在执行每日备份，需要保留10年，且备份与备份之间的保留间隔逐渐增大。

keep-last=3 - 即使只执行每日备份，管理员也可能希望在大升级之前或之后创建一个额外的备份。设置“保留最后”可确保这一点。

未设置每小时保持一次 - 对于每日备份，这与每日备份无关。您已经通过 Keep-Last 覆盖了额外的手动备份。

keep-daily=13 - 与至少涵盖一天的 keep-last 一起，这可确保您至少有两周的备份。

keep-weekly=8 - 确保您至少有两个完整月的每周备份。

keep-monthly=11 - 与之前的 keep 设置一起，这可确保您至少有一年的每月备份。

keep-year=9 - 这是针对长期存档的。当您使用以前的选项覆盖当年时，您将将其设置为9，以便将其余选项设置为9，从而为您提供至少10年的保险。

我们建议您使用比您的环境最低要求的保留期更高的保留期。如果您发现它不必要地高，则始终可以减少它，但是一旦删除备份，就无法重新创建备份。


