# 10.4复制与克隆

通常虚拟机操作系统需要使用安装光盘（CD-ROM）手工安装。这往往是一个非常耗时的操作。

部署多个同类型虚拟机时，可以采用复制原有虚拟机的方式。这种复制操作称为clone，并分为linked（链接克隆）和full（完整克隆）两类。

## 完整克隆

完整克隆可以创建一个完全独立的虚拟机，新虚拟机与原虚拟机之间不存在任何共享存储资源。

可以选择目标存储，从而将虚拟机复制到一个完全不同的存储设备。同时可以根据存储支持的情况选择改用其他磁盘格式。

- 注意
 - 完整克隆需要读取并复制虚拟机全部镜像数据。因此耗时往往较链接克隆长的多。

某些类型的存储支持复制指定快照，也就是当前的虚拟机数据。这也意味着最终的虚拟机不包含原虚拟机的其他快照。

## 链接克隆

现代存储驱动支持快速链接克隆技术。链接克隆生成一个可写副本，其初始内容和原数据一致。生成链接克隆的速度非常快，几乎可以瞬间完成，且刚创建时几乎不消耗存储空间。

顾名思义，链接克隆产生的新镜像仍然链接到源镜像。其核心技术称为Copy-on-wirte，如果数据块被改写（然后再读取），将写到一个新位置，如果数据块未被修改过，将直接从源镜像读取。


- 注意
 - 你不能删除创建有链接克隆的源模板。

创建链接克隆时不能改变目标存储，因为该技术依赖于存储内部功能特性。

通过设置目标节点选项，可以用链接克隆在其他节点创建新虚拟机。唯一需要确保的是，虚拟机保存在共享存储上，且共享存储已经挂载到目标节点。

为避免冲突，链接克隆虚拟机的所有网卡MAC地址都重新随机生成，虚拟机BIOS（smbios1）的UUID也会重新生成。

