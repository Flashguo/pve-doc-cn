
第九章  存储复制
===============================

命令行工具pvesr用于管理Proxmox VE存储复制框架。存储复制能够提高使用本地存储的客户机的冗余性，同时降低客户机迁移时间。

该工具能够将客户机的虚拟磁盘复制到其他节点，使得客户机数据在其他节点也可以访问，而无需共享存储。存储复制使用快照技术减少网络传输数据量。因此，在首次全量同步后只需传输新的增量数据即可。当节点发生故障时，你的客户机可以在复制节点上启动运行。

复制操作按照配置的时间间隔自动执行。最小复制时间间隔为1分钟，最大为1周。时间间隔配置采用systemd日历事件的子集来实现，具体可以参考9.2节“调度格式”。

每个客户机都可以同时复制到多个目标节点，但客户机不能两次同时复制到同一目标节点。

可以对每个复制的带宽进行限速，从而防止服务器或存储负载过重。

目前，配置了存储复制的虚拟机还不能进行在线迁移。但离线迁移是肯定没问题的。如果你将虚拟机迁移到复制节点，只要将最后一次同步复制后的增量数据（因此也称为delta）传输过去即可，从而大大缩短迁移时间。当迁移完成后，复制方向也会在两个节点间自动反转。

例如：VM100当前运行在nodeA节点，并被配置复制到nodeB节点。当你迁移VM100到nodeB之后，系统将自动调整复制方向，开始把VM100最新状态从nodeB再复制到nodeA节点。

如果你把虚拟机迁移到一个非复制节点，则需要将全部磁盘数据传输过去。迁移完成后，复制任务将继续把该虚拟机复制到原配置的复制节点。

注意： 允许与存储复制结合使用高可用性，但在上次同步时间和节点失败时间之间可能会有一些数据丢失。


.. toctree::
   :maxdepth: 2

   supporttype.md

